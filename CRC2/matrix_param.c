#include <stddef.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <memory.h>

uint8_t data[256] = {
    0x42, 0x4d, 0x96, 0x02, 0x36, 0x28, 0x32, 0x04, 0x01, 0x18, 0x60, 0x02, 0xe7, 0xbf, 0xc8, 0xc8, 
    0xe0, 0xdd, 0xf2, 0xff, 0xc8, 0xe0, 0xdd, 0x24, 0x1c, 0xed, 0xc8, 0xe0, 0xdd, 0xcc, 0x48, 0x3f, 
    0xe8, 0xa2, 0x57, 0x7a, 0xb9, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x1d, 0xe6, 0xb5, 0xcc, 0x48, 
    0x3f, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x4c, 0xb1, 0x22, 0x7f, 0x7f, 0x7f, 0xc8, 0xe0, 0xdd, 
    0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0xf2, 0xff, 0x4c, 0xb1, 0x22, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 
    0xdd, 0xcc, 0x48, 0x3f, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x7f, 0x7f, 0x7f, 0x24, 0x1c, 0xed, 
    0xcc, 0x48, 0x3f, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x24, 0x1c, 0xed, 0x27, 0x7f, 0xff, 0xc8, 
    0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x1d, 0xe6, 0xb5, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x9a, 0x76, 
    0x83, 0xc8, 0xe0, 0xdd, 0x57, 0x7a, 0xb9, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0x4c, 0xb1, 0x22, 
    0xe8, 0xa2, 0x24, 0x1c, 0xed, 0xc9, 0xae, 0xff, 0x24, 0x1c, 0xed, 0xcc, 0x48, 0x3f, 0xc8, 0xe0, 
    0xdd, 0x4c, 0xb1, 0x22, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 
    0xc8, 0xe0, 0xdd, 0x24, 0x1c, 0xed, 0xc8, 0xe0, 0xdd, 0x27, 0x7f, 0xff, 0xc8, 0xe0, 0xdd, 0xc8, 
    0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0xc9, 0xae, 0xff, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 0xdd, 0xc8, 0xe0, 
    0xdd, 0x57, 0x7a, 0xb9, 0xc8, 0xe0, 0xdd, 0x24, 0x1c, 0xed, 0xc8, 0xe0, 0xdd, 0xc8, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

uint64_t CRC64Table[256];

void crc64_init() {
    for (int i = 0; i < 256; ++i) {
        uint64_t tmp = i;
        for (int j = 0; j < 8; ++j) {
            if (tmp & 1) {
                tmp >>= 1;
                tmp ^= 0x8C997D55124358A1;
            } else {
                tmp >>= 1;
            }
        }
        CRC64Table[i] = tmp;
    }
}

uint64_t crc64(const void* lpBuffer, size_t len) {
    uint64_t CRC = 0;
    for (size_t i = 0; i < len; ++i) {
        uint8_t index = (uint8_t)(CRC ^ ((const uint8_t*)lpBuffer)[i]);
        CRC >>= 8;
        CRC ^= CRC64Table[index];
    }
    return CRC;
}

int main(int argc, char* argv[]) {
    uint64_t crc;

    crc64_init();

    for (int i = 0; i < 13; ++i)
        data[i * 20] = '0';

    crc = crc64(data, 256);
    printf("TargetCRC = 0x%016llx\n", crc ^ 0x81BAD8907DE045EB);
    printf("\n");
    printf("CRCsOfMasks = [\n");
    for (int i = 0; i < 13; ++i) {
        for (int j = 0; j < 7; ++j) {
            uint8_t mask[256];
            memset(mask, 0, 256);

            mask[i * 20] = 1 << j;

            crc = crc64(mask, 256);
            printf("    0x%016llx,\n", crc);
        }
    }
    printf("]\n");
    return 0;
}
